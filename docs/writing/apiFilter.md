---
title: 如何做到接口防刷
nav:
  title: 编程题
  path: /writing
  order: 0
group:
  title: 编程题
  path: /writing/project
---

# 如何做到接口防刷

- 2022.11.04

## 1. 负载均衡层的限流，防止用户重复抽奖

在负载均衡设备中做一些配置，判断如果同一个用户在 1 分钟之内多次发送请求来进行抽奖，就认为是恶意重复抽奖，或者是他们自己写的脚本在刷。

这种流量一律认为是无效流量，在负载均衡设备那个层次就给直接屏蔽掉。 所以这里就可以把无效流量给拦截掉。

## 2. 暴力拦截流量

针对秒杀、抢红包、抽奖，这类活动有一个共同的特点，那就是假设有 50 万请求涌入进来，可能前 5 万请求就直接把事儿干完了，甚至是前 500 请求就把事儿干完了。

后续的几十万流量是无效的，不需要让他们进入后台系统执行业务逻辑了。

这样的话，其实在负载均衡这一层（可以考虑用 Nginx 之类的来实现）就可以拦截掉 99%的无效流量。

## 3. ip 或用户抽奖次数校验

建立一个抽奖表，该表记录所有参与抽奖的 ip 和用户信息，比如判断 5s 内，该用户连续抽奖了 2 次以上，就拒绝该请求，认为是在刷接口，就把该用户和 ip 加入黑名单。
