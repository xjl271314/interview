---
title: CSS性能优化
nav:
  title: css
  path: /css
group:
  title: css相关试题
  path: /css/project
---

# 如何提升 CSS 的性能?

- 2021.06.22

## 提高 CSS 性能的方法有哪些?

1. 合并 `css` 文件，如果页面加载 `10 个 css` 文件,每个文件 `1k`，那么也要比只加载一个 `100k` 的 `css` 文件慢。
2. 减少 `css` 嵌套，最好不要嵌套三层以上。
3. 不要在 `ID` 选择器前面进行嵌套，`ID` 本来就是唯一的而且`权重值大`，嵌套完全是浪费性能。
4. 建立`公共样式类`，把相同样式提取出来作为公共类使用。
5. 减少`通配符*`或者类似`[hidden="true"]`这类选择器的使用，挨个查找所有`...`这性能能好吗？
6. 巧妙运用 `css` 的继承机制，如果父节点定义了某些子节点继承的属性，子节点就无需定义。
7. 拆分出公共 `css` 文件，对于比较大的项目可以将大部分页面的公共结构样式提取出来放到单独 `css` 文件里，这样一次下载 后就放到缓存里，当然这种做法会增加请求，具体做法应以实际情况而定。
8. 不用 `css` 表达式，表达式只是让你的代码显得更加酷炫，但是对性能的浪费可能是超乎你想象的。
9. 少用 `css rest`，可能会觉得重置样式是规范，但是其实其中有很多操作是不必要不友好的，有需求有兴趣，可以选择 `normolize.css`。
10. `cssSprite`，合成所有 `icon` 图片，用宽高加上`background-position` 的背景图方式显现 `icon` 图，这样很实用，减少了 `http` 请求。
11. 善后工作，`css 压缩(在线压缩工具 YUI Compressor)`
12. `GZIP 压缩`，是一种流行的文件压缩算法。

## 性能优化

### 1. 避免使用@import

> 外部的 `css` 文件中使用`@import` 会使得页面在加载时增加额外的延迟。

我们知道通过 `link` 和`@import` 都可以去加载 `css`，但是两者存在以下一些区别:

- `link` 是 `XHTML` 标签，除了加载 `CSS` 外，还可以定义 `RSS` 等其他事务；`@import` 属于 `CSS` 范畴，只能加载 `CSS`。

- `link` 引用 `CSS` 时，在页面载入时同时加载；`@import` 需要页面网页完全载入以后加载。所以会出现一开始没有 `css` 样式，闪烁一下出现样式后的页面(网速慢的情况下)。

另外，多个`@import` 会导致下载顺序紊乱，在 `IE` 中，`@import` 会引发资源文件的下载顺序被打乱，即排列在`@import` 后面的 `js` 文件优先于`@import` 下载，并且打乱甚至破坏`@import` 自身的并行下载。

### 2. 尽量减少页面重排、重绘

#### 重排

1. 浏览器为了重新渲染部分或整个页面，重新计算页面元素位置和几何结构。

2. 浏览器根据定义好的样式来计算，并将元素放到该出现的位置上。

3. 页面上任何一个节点触发来 reflow，会导致他的子节点和祖先节点重新渲染。

#### 有以下几种情况会触发页面`重排(reflow)`

1. 改变窗口的大小
2. 改变文字的大小
3. 添加 删除样式表
4. 内容的改变 输入框输入内容也会
5. 伪类的激活
6. 操作 class 属性
7. 脚本操作 dom js 改变 css 类
8. 计算 offsetWidth 和 offsetHeight
9. 设置 style 属性
10. 改变元素的内外边距

#### 常见重排元素

1. 大小有关的 `width`,`height`,`padding`,`margin`,`border-width`,`border`,`min-height`。

2. 布局有关的 `display`,`top`,`position`,`float`,`left`,`right`,`bottom`。

3. 字体有关的 `font-size`,`text-align`,`font-weight`,`font-family`,`line-height`,`white-space`,`vertical-align`。

4. 隐藏有关的 `overflow`,`overflow-x`,`overflow-y`。

#### 减少 `reflow` 对性能的影响的建议

1. 不要一条条的修改 dom 的样式，预先定义好 class，然后修改 dom 的 classname。
2. 不要修改影响范围较大的 dom。
3. 为动画元素使用绝对定位。
4. 不要 table 布局，因为一个很小的改动会造成整个 table 重新布局。
5. 避免设置大量的 style 属性，通过设置 style 属性改变节点样式的话，每一次设置都会触发一次 reflow，所以最好使用 class 属性。
6. 如果 css 里面有计算表达式，每次都会重新计算一遍，触发一次 reflow。

#### 重绘

1. 当一个元素的外观被改变，但是布局没有改变的情况

2. 当元素改变的时候，不影响元素在页面中的位置，浏览器仅仅会用新的样式重绘此元素

#### 常见的重绘元素

- 颜色： `color`,`background`。
- 边框样式： `border-style`,`outline-color`,`outline`,`outline-style`,`border-radius`,`box-shadow`,`outline-width`。
- 背景有关： `background`,`backgound-image`,`background-position`,`background-repeat`,`background-size`。
- 动画相关: `transofrm`。

CSS 的最终表现分为以下四步：`Recalculate Style -> Layout -> Paint Setup and Paint -> Composite Layers`。

大致是 `查找并计算样式 -> 排布 -> 绘制 -> 组合层`。

由于 `transform` 是位于 `Composite Layers 层`，而 `width`、`left`、`margin` 等则是位于 `Layout`层，在 `Layout` 层发生的改变必定导致 `Paint Setup and Paint -> Composite Layers`，所以相对而言使用 `transform` 实现的动画效果肯定比 `left` 这些更加流畅。

而且就算抛开这一角度，在另一方面浏览器也会针对 `transform` 等开启 `GPU` 加速。

## 3. 使用文件压缩

通过将写好的 css 进行打包压缩，可以减少很多的体积，提高加载速度。

## 4. 去除无用 CSS

- 去除空规则：`｛｝`。空规则的产生原因一般来说是为了预留样式。去除这些空规则无疑能减少 css 文档体积。

- 重复使用的样式进行公共 CSS 的提取。

## 5. 正确的使用选择器

`css 选择器`的匹配是`从右向左`进行的，这一策略导致来不同种类的选择器之间的性能也存在差异。

- `减少使用后代选择器`：选择器的最后面的部分为关键选择器（即用来匹配目标元素的部分），当使用后代选择器的时候，浏览器会遍历所有子元素来确定是否是指定的元素等等。

- `避免使用通配规则`：如`*{}`计算次数惊人！只对需要用到的元素进行选择。

- `避免使用ID选择器`：如果规则拥有 `ID选择器` 作为其关键选择器，则不要为规则增加标签。过滤掉无关的规则（这样样式系统就不会浪费时间去匹配它们了）。但是实际中尽量不要使用`ID选择器`,因为其权重较高。

- `减少对可继承属性的书写`：了解哪些属性是可以通过继承而来的，然后避免对这些属性重复指定规则。

- `避免过深的嵌套选择器`：选择器的合理层级不要超过三层。

## 6. 优化 CSS 书写

- 属性值为 0 时，不加单位。

- 属性值为浮动小数 `0.**`，可以省略小数点之前的 0。

- 标准化各种浏览器前缀：带浏览器前缀的在前。标准属性在后。

- 正确使用 `display` 的属性，由于 `display` 的作用，某些样式组合会无效，徒增样式体积的同时也影响解析性能。

- 不滥用 `web` 字体。对于中文网站来说 `WebFonts` 可能很陌生，国外却很流行。`webfonts` 通常体积庞大，而且一些浏览器在下载 `webFonts` 时会阻塞页面渲染损伤性能。

-
